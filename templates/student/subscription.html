{% extends 'base.html' %}

{% block title %}–ê–±–æ–Ω–µ–º–µ–Ω—Ç | –£–º–Ω–∞—è —Å—Ç–æ–ª–æ–≤–∞—è{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">–ê–±–æ–Ω–µ–º–µ–Ω—Ç –Ω–∞ –ø–∏—Ç–∞–Ω–∏–µ</h1>
    <p class="page-subtitle">–û–ø–ª–∞—á–∏–≤–∞–π—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ –∑–∞—Ä–∞–Ω–µ–µ –∏ —ç–∫–æ–Ω–æ–º—å—Ç–µ</p>
</div>

{% if active_subscription %}
<div class="alert alert-success">
    ‚ú® –£ –≤–∞—Å –∞–∫—Ç–∏–≤–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç –¥–æ <strong>{{ active_subscription.end_date|date:"d.m.Y" }}</strong>
    ({{ active_subscription.get_meal_type_display }})
</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h2 class="card-title">–û—Ñ–æ—Ä–º–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç</h2>
        <span class="text-muted">–ë–∞–ª–∞–Ω—Å: {{ user.balance }} ‚ÇΩ</span>
    </div>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label class="form-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label>
            <select name="duration" class="form-input" id="duration">
                <option value="7">1 –Ω–µ–¥–µ–ª—è (7 –¥–Ω–µ–π)</option>
                <option value="14">2 –Ω–µ–¥–µ–ª–∏ (14 –¥–Ω–µ–π)</option>
                <option value="30">1 –º–µ—Å—è—Ü (30 –¥–Ω–µ–π)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">–¢–∏–ø –ø–∏—Ç–∞–Ω–∏—è</label>
            <select name="meal_type" class="form-input" id="meal_type">
                <option value="breakfast">–¢–æ–ª—å–∫–æ –∑–∞–≤—Ç—Ä–∞–∫</option>
                <option value="lunch">–¢–æ–ª—å–∫–æ –æ–±–µ–¥</option>
                <option value="both">–ó–∞–≤—Ç—Ä–∞–∫ –∏ –æ–±–µ–¥</option>
            </select>
        </div>
        
        <div class="card mb-3" style="background: var(--primary-bg);">
            <h3 class="mb-2">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="price">700</span> ‚ÇΩ</h3>
            <p class="text-muted">–¶–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</p>
        </div>
        
        <button type="submit" class="btn btn-primary btn-block">–û—Ñ–æ—Ä–º–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç</button>
    </form>
</div>

<div class="card mt-3">
    <div class="card-header">
        <h2 class="card-title">üìã –¢–∞—Ä–∏—Ñ—ã</h2>
    </div>
    
    <table class="table">
        <thead>
            <tr>
                <th>–ü–µ—Ä–∏–æ–¥</th>
                <th>–ó–∞–≤—Ç—Ä–∞–∫</th>
                <th>–û–±–µ–¥</th>
                <th>–ó–∞–≤—Ç—Ä–∞–∫ + –û–±–µ–¥</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1 –Ω–µ–¥–µ–ª—è</td>
                <td>700 ‚ÇΩ</td>
                <td>1000 ‚ÇΩ</td>
                <td>1500 ‚ÇΩ</td>
            </tr>
            <tr>
                <td>2 –Ω–µ–¥–µ–ª–∏</td>
                <td>1300 ‚ÇΩ</td>
                <td>1900 ‚ÇΩ</td>
                <td>2800 ‚ÇΩ</td>
            </tr>
            <tr>
                <td>1 –º–µ—Å—è—Ü</td>
                <td>2500 ‚ÇΩ</td>
                <td>3800 ‚ÇΩ</td>
                <td>5500 ‚ÇΩ</td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
const prices = {
    '7': {'breakfast': 700, 'lunch': 1000, 'both': 1500},
    '14': {'breakfast': 1300, 'lunch': 1900, 'both': 2800},
    '30': {'breakfast': 2500, 'lunch': 3800, 'both': 5500}
};

function updatePrice() {
    const duration = document.getElementById('duration').value;
    const mealType = document.getElementById('meal_type').value;
    document.getElementById('price').textContent = prices[duration][mealType];
}

document.getElementById('duration').addEventListener('change', updatePrice);
document.getElementById('meal_type').addEventListener('change', updatePrice);
</script>
{% endblock %}
