{% extends 'base.html' %}

{% block title %}Профиль | Умная столовая{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Мой профиль</h1>
    <p class="page-subtitle">Управление личными данными</p>
</div>

<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Личные данные</h2>
        </div>
        
        <form method="post">
            {% csrf_token %}
            
            <div class="form-group">
                <label class="form-label">ФИО</label>
                <input type="text" name="name" value="{{ user.name }}" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" name="email" value="{{ user.email }}" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Дата рождения</label>
                <input type="date" name="birth_date" value="{{ user.birth_date|date:'Y-m-d' }}" class="form-input">
            </div>
            
            {% if user.role == 'student' %}
            <div class="form-group">
                <label class="form-label">Мои аллергены</label>
                <div class="checkbox-list">
                    {% for alergen in form.alergens_choices.field.queryset %}
                    <label>
                        <input type="checkbox" name="alergens_choices" value="{{ alergen.id }}"
                            {% if alergen in form.alergens_choices.initial %}checked{% endif %}>
                        {{ alergen.name }}
                    </label>
                    {% empty %}
                    <p class="text-muted">Аллергены не добавлены в систему</p>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
        </form>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Информация об аккаунте</h2>
        </div>
        
        <div class="mb-2">
            <strong>Логин:</strong> {{ user.login }}
        </div>
        
        <div class="mb-2">
            <strong>Роль:</strong> 
            <span class="badge badge-primary">{{ user.get_role_display }}</span>
        </div>
        
        {% if user.role == 'student' %}
        <div class="mb-2">
            <strong>Баланс:</strong> 
            <span class="text-primary" style="font-size: 1.5rem; font-weight: 700;">{{ user.balance }} ₽</span>
        </div>
        
        <div class="mt-3">
            <a href="{% url 'student_payment' %}" class="btn btn-secondary">Пополнить баланс</a>
        </div>
        {% endif %}
        
        {% if user_alergens %}
        <div class="mt-3">
            <strong>Ваши аллергены:</strong>
            <div class="mt-1">
                {% for alergen in user_alergens %}
                    <span class="badge badge-warning">{{ alergen.name }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
